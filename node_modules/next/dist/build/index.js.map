{"version":3,"sources":["../../build/index.ts"],"names":["staticCheckWorker","require","resolve","build","dir","conf","reactProductionProfiling","debugOutput","span","tracer","startSpan","Error","loadedEnvFiles","Log","config","PHASE_PRODUCTION_BUILD","target","buildId","generateBuildId","nanoid","distDir","path","join","headers","rewrites","redirects","ciEnvironment","isCI","hasNextSupport","cacheDir","hasCache","console","log","prefixes","warn","buildSpinner","prefixText","info","telemetry","Telemetry","publicDir","pagesDir","hasPublicDir","record","cliCommand","isSrcDir","relative","startsWith","hasNowJson","cwd","isCustomServer","then","events","ignoreTypeScriptErrors","Boolean","typescript","ignoreBuildErrors","chromeProfiler","experimental","profiling","createTrace","profiler","startProfiling","isLikeServerless","pagePaths","pageExtensions","allStaticPages","Set","allPageInfos","Map","previewProps","previewModeId","crypto","randomBytes","toString","previewModeSigningKey","previewModeEncryptionKey","mappedPages","entrypoints","pageKeys","Object","keys","conflictingPublicFiles","hasCustomErrorPage","hasPages404","hasNonStaticErrorPage","hasPublicUnderScoreNextDir","PUBLIC_DIR_MIDDLEWARE_CONFLICT","page","hasPublicPageFile","push","numConflicting","length","nestedReservedPages","filter","match","dirname","buildCustomRoute","r","type","routeRegex","source","strict","sensitive","delimiter","statusCode","permanent","undefined","regex","routesManifestPath","ROUTES_MANIFEST","routesManifest","version","pages404","basePath","map","dynamicRoutes","isDynamicRoute","re","routeKeys","namedRegex","dataRoutes","i18n","promises","mkdir","recursive","writeFile","JSON","stringify","manifestPath","SERVERLESS_DIRECTORY","SERVER_DIRECTORY","PAGES_MANIFEST","requiredServerFiles","compress","configFile","files","BUILD_MANIFEST","PRERENDER_MANIFEST","REACT_LOADABLE_MANIFEST","optimizeFonts","FONT_MANIFEST","BUILD_ID_FILE","nonNullable","file","ignore","configs","Promise","all","isServer","client","server","clientConfig","optimization","minimize","minimizer","webpackBuildStart","process","hrtime","result","warnings","errors","clientResult","serverResult","webpackBuildEnd","stopAndPersist","error","chalk","red","indexOf","page_name_regex","parsed","exec","page_name","groups","durationInSeconds","postCompileSpinner","buildManifestPath","ssgPages","ssgStaticFallbackPages","ssgBlockingFallbackPages","staticPages","invalidPages","hybridAmpPages","serverPropsPages","additionalSsgPaths","pageInfos","pagesManifest","parse","readFile","buildManifest","customAppGetInitialProps","namedExports","isNextImageImported","env","NEXT_PHASE","staticCheckWorkers","Worker","numWorkers","cpus","enableWorkerThreads","workerThreads","getStdout","pipe","stdout","getStderr","stderr","runtimeEnvConfig","publicRuntimeConfig","serverRuntimeConfig","hasSsrAmpPages","analysisBegin","actualPage","selfSize","allSize","isSsg","isStatic","isHybridAmp","ssgPageRoutes","nonReservedPage","serverBundle","bold","yellow","workerResult","isPageStatic","locales","defaultLocale","isAmpOnly","add","hasStaticProps","prerenderRoutes","set","prerenderFallback","hasServerProps","PAGES_404_GET_INITIAL_PROPS_ERROR","delete","err","message","size","totalSize","static","initialRevalidateSeconds","end","pagePath","dataRoute","posix","dataRouteRegex","namedDataRouteRegex","replace","RegExp","useStatic404","pg","SERVER_FILES_MANIFEST","finalPrerenderRoutes","tbdPrerenderRoutes","ssgNotFoundPaths","combinedPages","exportApp","default","exportOptions","silent","buildExport","threads","pages","outdir","statusMessage","exportConfig","initialPageRevalidationMap","exportPathMap","defaultMap","forEach","has","query","__nextFallback","routes","route","isDynamic","isFallback","locale","outputPath","__nextLocale","trailingSlash","postBuildSpinner","unlink","serverOutputDir","moveExportedPage","originPage","ext","additionalSsgFile","orig","relativeDest","substr","split","dest","isNotFound","includes","rename","curPath","localeExt","extname","relativeDestNoPages","updatedRelativeDest","updatedOrig","updatedDest","isStaticSsgFallback","hasAmp","ampPage","revalidationMapPath","srcRoute","pageInfo","get","extraRoutes","pageFile","rmdir","analysisEnd","staticPageCount","staticPropsPageCount","serverPropsPageCount","ssrPageCount","hasStatic404","hasReportWebVitals","rewritesCount","headersCount","redirectsCount","finalDynamicRoutes","tbdRoute","normalizedRoute","fallback","prerenderManifest","notFoundRoutes","preview","generateClientSsgManifest","images","deviceSizes","imageSizes","sizes","IMAGES_MANIFEST","EXPORT_MARKER","hasExportPathMap","exportTrailingSlash","EXPORT_DETAIL","catch","code","reject","key","distPath","analyticsId","green","parsedResults","stopProfiling","destroy","trace","flush","cpuStartTime","profile","startTime","cpuEndTime","endTime","completeEvent","name","id","counter","cat","ts","args","src_file","src_func","dur","data","url","lineNumber","columnNumber","frame","instantEvent","cpuProfile","entries","clientSsgManifestContent","CLIENT_STATIC_FILES_PATH"],"mappings":"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","sourcesContent":["import { loadEnvConfig } from '@next/env'\nimport chalk from 'chalk'\nimport crypto from 'crypto'\nimport { promises, writeFileSync } from 'fs'\nimport Worker from 'jest-worker'\nimport devalue from 'next/dist/compiled/devalue'\nimport escapeStringRegexp from 'next/dist/compiled/escape-string-regexp'\nimport findUp from 'next/dist/compiled/find-up'\nimport nanoid from 'next/dist/compiled/nanoid/index.js'\nimport { pathToRegexp } from 'next/dist/compiled/path-to-regexp'\nimport path from 'path'\nimport formatWebpackMessages from '../client/dev/error-overlay/format-webpack-messages'\nimport {\n  PAGES_404_GET_INITIAL_PROPS_ERROR,\n  PUBLIC_DIR_MIDDLEWARE_CONFLICT,\n} from '../lib/constants'\nimport { fileExists } from '../lib/file-exists'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport loadCustomRoutes, {\n  getRedirectStatus,\n  normalizeRouteRegex,\n  Redirect,\n  RouteType,\n} from '../lib/load-custom-routes'\nimport { nonNullable } from '../lib/non-nullable'\nimport { recursiveDelete } from '../lib/recursive-delete'\nimport { verifyTypeScriptSetup } from '../lib/verifyTypeScriptSetup'\nimport {\n  BUILD_ID_FILE,\n  BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  EXPORT_DETAIL,\n  EXPORT_MARKER,\n  FONT_MANIFEST,\n  IMAGES_MANIFEST,\n  PAGES_MANIFEST,\n  PHASE_PRODUCTION_BUILD,\n  PRERENDER_MANIFEST,\n  REACT_LOADABLE_MANIFEST,\n  ROUTES_MANIFEST,\n  SERVERLESS_DIRECTORY,\n  SERVER_DIRECTORY,\n  SERVER_FILES_MANIFEST,\n} from '../next-server/lib/constants'\nimport {\n  getRouteRegex,\n  getSortedRoutes,\n  isDynamicRoute,\n} from '../next-server/lib/router/utils'\nimport { __ApiPreviewProps } from '../next-server/server/api-utils'\nimport loadConfig, {\n  isTargetLikeServerless,\n} from '../next-server/server/config'\nimport { BuildManifest } from '../next-server/server/get-page-files'\nimport '../next-server/server/node-polyfill-fetch'\nimport { normalizePagePath } from '../next-server/server/normalize-page-path'\nimport { getPagePath } from '../next-server/server/require'\nimport * as ciEnvironment from '../telemetry/ci-info'\nimport {\n  eventBuildCompleted,\n  eventBuildOptimize,\n  eventCliSession,\n  eventNextPlugins,\n} from '../telemetry/events'\nimport { Telemetry } from '../telemetry/storage'\nimport { CompilerResult, runCompiler } from './compiler'\nimport { createEntrypoints, createPagesMapping } from './entries'\nimport { generateBuildId } from './generate-build-id'\nimport { isWriteable } from './is-writeable'\nimport * as Log from './output/log'\nimport createSpinner from './spinner'\nimport { traceAsyncFn, tracer } from './tracer'\nimport {\n  collectPages,\n  getJsPageSizeInKb,\n  getNamedExports,\n  hasCustomGetInitialProps,\n  isPageStatic,\n  PageInfo,\n  printCustomRoutes,\n  printTreeView,\n} from './utils'\nimport getBaseWebpackConfig from './webpack-config'\nimport { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\nimport { writeBuildId } from './write-build-id'\n\nconst staticCheckWorker = require.resolve('./utils')\n\nexport type SsgRoute = {\n  initialRevalidateSeconds: number | false\n  srcRoute: string | null\n  dataRoute: string\n}\n\nexport type DynamicSsgRoute = {\n  routeRegex: string\n  fallback: string | null | false\n  dataRoute: string\n  dataRouteRegex: string\n}\n\nexport type PrerenderManifest = {\n  version: 2\n  routes: { [route: string]: SsgRoute }\n  dynamicRoutes: { [route: string]: DynamicSsgRoute }\n  notFoundRoutes: string[]\n  preview: __ApiPreviewProps\n}\n\nexport default async function build(\n  dir: string,\n  conf = null,\n  reactProductionProfiling = false,\n  debugOutput = false\n): Promise<void> {\n  const span = tracer.startSpan('build')\n  return traceAsyncFn(span, async () => {\n    if (!(await isWriteable(dir))) {\n      throw new Error(\n        '> Build directory is not writeable. https://err.sh/vercel/next.js/build-dir-not-writeable'\n      )\n    }\n\n    // attempt to load global env values so they are available in next.config.js\n    const { loadedEnvFiles } = loadEnvConfig(dir, false, Log)\n\n    const config = loadConfig(PHASE_PRODUCTION_BUILD, dir, conf)\n    const { target } = config\n    const buildId = await generateBuildId(config.generateBuildId, nanoid)\n    const distDir = path.join(dir, config.distDir)\n\n    const { headers, rewrites, redirects } = await loadCustomRoutes(config)\n\n    if (ciEnvironment.isCI && !ciEnvironment.hasNextSupport) {\n      const cacheDir = path.join(distDir, 'cache')\n      const hasCache = await fileExists(cacheDir)\n\n      if (!hasCache) {\n        // Intentionally not piping to stderr in case people fail in CI when\n        // stderr is detected.\n        console.log(\n          `${Log.prefixes.warn} No build cache found. Please configure build caching for faster rebuilds. Read more: https://err.sh/next.js/no-cache`\n        )\n      }\n    }\n\n    const buildSpinner = createSpinner({\n      prefixText: `${Log.prefixes.info} Creating an optimized production build`,\n    })\n\n    const telemetry = new Telemetry({ distDir })\n\n    const publicDir = path.join(dir, 'public')\n    const pagesDir = findPagesDir(dir)\n    const hasPublicDir = await fileExists(publicDir)\n\n    telemetry.record(\n      eventCliSession(PHASE_PRODUCTION_BUILD, dir, {\n        cliCommand: 'build',\n        isSrcDir: path.relative(dir, pagesDir!).startsWith('src'),\n        hasNowJson: !!(await findUp('now.json', { cwd: dir })),\n        isCustomServer: null,\n      })\n    )\n\n    eventNextPlugins(path.resolve(dir)).then((events) =>\n      telemetry.record(events)\n    )\n\n    const ignoreTypeScriptErrors = Boolean(config.typescript?.ignoreBuildErrors)\n    await verifyTypeScriptSetup(dir, pagesDir, !ignoreTypeScriptErrors)\n\n    let chromeProfiler: any = null\n    if (config.experimental.profiling) {\n      const { createTrace } = require('./profiler/profiler.js')\n      chromeProfiler = createTrace(path.join(distDir, `profile-events.json`))\n      chromeProfiler.profiler.startProfiling()\n    }\n\n    const isLikeServerless = isTargetLikeServerless(target)\n\n    const pagePaths: string[] = await collectPages(\n      pagesDir,\n      config.pageExtensions\n    )\n\n    // needed for static exporting since we want to replace with HTML\n    // files\n    const allStaticPages = new Set<string>()\n    let allPageInfos = new Map<string, PageInfo>()\n\n    const previewProps: __ApiPreviewProps = {\n      previewModeId: crypto.randomBytes(16).toString('hex'),\n      previewModeSigningKey: crypto.randomBytes(32).toString('hex'),\n      previewModeEncryptionKey: crypto.randomBytes(32).toString('hex'),\n    }\n\n    const mappedPages = createPagesMapping(pagePaths, config.pageExtensions)\n    const entrypoints = createEntrypoints(\n      mappedPages,\n      target,\n      buildId,\n      previewProps,\n      config,\n      loadedEnvFiles\n    )\n    const pageKeys = Object.keys(mappedPages)\n    const conflictingPublicFiles: string[] = []\n    const hasCustomErrorPage = mappedPages['/_error'].startsWith(\n      'private-next-pages'\n    )\n    const hasPages404 = Boolean(\n      mappedPages['/404'] &&\n        mappedPages['/404'].startsWith('private-next-pages')\n    )\n    let hasNonStaticErrorPage: boolean\n\n    if (hasPublicDir) {\n      const hasPublicUnderScoreNextDir = await fileExists(\n        path.join(publicDir, '_next')\n      )\n      if (hasPublicUnderScoreNextDir) {\n        throw new Error(PUBLIC_DIR_MIDDLEWARE_CONFLICT)\n      }\n    }\n\n    // Check if pages conflict with files in `public`\n    // Only a page of public file can be served, not both.\n    for (const page in mappedPages) {\n      const hasPublicPageFile = await fileExists(\n        path.join(publicDir, page === '/' ? '/index' : page),\n        'file'\n      )\n      if (hasPublicPageFile) {\n        conflictingPublicFiles.push(page)\n      }\n    }\n\n    const numConflicting = conflictingPublicFiles.length\n\n    if (numConflicting) {\n      throw new Error(\n        `Conflicting public and page file${\n          numConflicting === 1 ? ' was' : 's were'\n        } found. https://err.sh/vercel/next.js/conflicting-public-file-page\\n${conflictingPublicFiles.join(\n          '\\n'\n        )}`\n      )\n    }\n\n    const nestedReservedPages = pageKeys.filter((page) => {\n      return (\n        page.match(/\\/(_app|_document|_error)$/) && path.dirname(page) !== '/'\n      )\n    })\n\n    if (nestedReservedPages.length) {\n      Log.warn(\n        `The following reserved Next.js pages were detected not directly under the pages directory:\\n` +\n          nestedReservedPages.join('\\n') +\n          `\\nSee more info here: https://err.sh/next.js/nested-reserved-page\\n`\n      )\n    }\n\n    const buildCustomRoute = (\n      r: {\n        source: string\n        locale?: false\n        basePath?: false\n        statusCode?: number\n        destination?: string\n      },\n      type: RouteType\n    ) => {\n      const keys: any[] = []\n\n      const routeRegex = pathToRegexp(r.source, keys, {\n        strict: true,\n        sensitive: false,\n        delimiter: '/', // default is `/#?`, but Next does not pass query info\n      })\n\n      return {\n        ...r,\n        ...(type === 'redirect'\n          ? {\n              statusCode: getRedirectStatus(r as Redirect),\n              permanent: undefined,\n            }\n          : {}),\n        regex: normalizeRouteRegex(routeRegex.source),\n      }\n    }\n\n    const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n    const routesManifest: {\n      version: number\n      pages404: boolean\n      basePath: string\n      redirects: Array<ReturnType<typeof buildCustomRoute>>\n      rewrites: Array<ReturnType<typeof buildCustomRoute>>\n      headers: Array<ReturnType<typeof buildCustomRoute>>\n      dynamicRoutes: Array<{\n        page: string\n        regex: string\n        namedRegex?: string\n        routeKeys?: { [key: string]: string }\n      }>\n      dataRoutes: Array<{\n        page: string\n        routeKeys?: { [key: string]: string }\n        dataRouteRegex: string\n        namedDataRouteRegex?: string\n      }>\n      i18n?: {\n        domains?: Array<{\n          http?: true\n          domain: string\n          locales?: string[]\n          defaultLocale: string\n        }>\n        locales: string[]\n        defaultLocale: string\n        localeDetection?: false\n      }\n    } = {\n      version: 3,\n      pages404: true,\n      basePath: config.basePath,\n      redirects: redirects.map((r) => buildCustomRoute(r, 'redirect')),\n      rewrites: rewrites.map((r) => buildCustomRoute(r, 'rewrite')),\n      headers: headers.map((r) => buildCustomRoute(r, 'header')),\n      dynamicRoutes: getSortedRoutes(pageKeys)\n        .filter(isDynamicRoute)\n        .map((page) => {\n          const routeRegex = getRouteRegex(page)\n          return {\n            page,\n            regex: normalizeRouteRegex(routeRegex.re.source),\n            routeKeys: routeRegex.routeKeys,\n            namedRegex: routeRegex.namedRegex,\n          }\n        }),\n      dataRoutes: [],\n      i18n: config.i18n || undefined,\n    }\n\n    await promises.mkdir(distDir, { recursive: true })\n    // We need to write the manifest with rewrites before build\n    // so serverless can import the manifest\n    await promises.writeFile(\n      routesManifestPath,\n      JSON.stringify(routesManifest),\n      'utf8'\n    )\n\n    const manifestPath = path.join(\n      distDir,\n      isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n      PAGES_MANIFEST\n    )\n\n    const requiredServerFiles = {\n      version: 1,\n      config: {\n        ...config,\n        compress: false,\n        configFile: undefined,\n      },\n      files: [\n        ROUTES_MANIFEST,\n        path.relative(distDir, manifestPath),\n        BUILD_MANIFEST,\n        PRERENDER_MANIFEST,\n        REACT_LOADABLE_MANIFEST,\n        config.experimental.optimizeFonts\n          ? path.join(\n              isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n              FONT_MANIFEST\n            )\n          : null,\n        BUILD_ID_FILE,\n      ]\n        .filter(nonNullable)\n        .map((file) => path.join(config.distDir, file)),\n      ignore: [\n        path.relative(\n          dir,\n          path.join(path.dirname(require.resolve('sharp')), '**/*')\n        ),\n      ],\n    }\n\n    const configs = await Promise.all([\n      getBaseWebpackConfig(dir, {\n        tracer: chromeProfiler,\n        buildId,\n        reactProductionProfiling,\n        isServer: false,\n        config,\n        target,\n        pagesDir,\n        entrypoints: entrypoints.client,\n        rewrites,\n      }),\n      getBaseWebpackConfig(dir, {\n        tracer: chromeProfiler,\n        buildId,\n        reactProductionProfiling,\n        isServer: true,\n        config,\n        target,\n        pagesDir,\n        entrypoints: entrypoints.server,\n        rewrites,\n      }),\n    ])\n\n    const clientConfig = configs[0]\n\n    if (\n      clientConfig.optimization &&\n      (clientConfig.optimization.minimize !== true ||\n        (clientConfig.optimization.minimizer &&\n          clientConfig.optimization.minimizer.length === 0))\n    ) {\n      Log.warn(\n        `Production code optimization has been disabled in your project. Read more: https://err.sh/vercel/next.js/minification-disabled`\n      )\n    }\n\n    const webpackBuildStart = process.hrtime()\n\n    let result: CompilerResult = { warnings: [], errors: [] }\n    // TODO: why do we need this?? https://github.com/vercel/next.js/issues/8253\n    if (isLikeServerless) {\n      const clientResult = await runCompiler(clientConfig)\n      // Fail build if clientResult contains errors\n      if (clientResult.errors.length > 0) {\n        result = {\n          warnings: [...clientResult.warnings],\n          errors: [...clientResult.errors],\n        }\n      } else {\n        const serverResult = await runCompiler(configs[1])\n        result = {\n          warnings: [...clientResult.warnings, ...serverResult.warnings],\n          errors: [...clientResult.errors, ...serverResult.errors],\n        }\n      }\n    } else {\n      result = await runCompiler(configs)\n    }\n\n    const webpackBuildEnd = process.hrtime(webpackBuildStart)\n    if (buildSpinner) {\n      buildSpinner.stopAndPersist()\n    }\n\n    result = formatWebpackMessages(result)\n\n    if (result.errors.length > 0) {\n      // Only keep the first error. Others are often indicative\n      // of the same problem, but confuse the reader with noise.\n      if (result.errors.length > 1) {\n        result.errors.length = 1\n      }\n      const error = result.errors.join('\\n\\n')\n\n      console.error(chalk.red('Failed to compile.\\n'))\n\n      if (\n        error.indexOf('private-next-pages') > -1 &&\n        error.indexOf('does not contain a default export') > -1\n      ) {\n        const page_name_regex = /'private-next-pages\\/(?<page_name>[^']*)'/\n        const parsed = page_name_regex.exec(error)\n        const page_name = parsed && parsed.groups && parsed.groups.page_name\n        throw new Error(\n          `webpack build failed: found page without a React Component as default export in pages/${page_name}\\n\\nSee https://err.sh/vercel/next.js/page-without-valid-component for more info.`\n        )\n      }\n\n      console.error(error)\n      console.error()\n\n      if (\n        error.indexOf('private-next-pages') > -1 ||\n        error.indexOf('__next_polyfill__') > -1\n      ) {\n        throw new Error(\n          '> webpack config.resolve.alias was incorrectly overridden. https://err.sh/vercel/next.js/invalid-resolve-alias'\n        )\n      }\n      throw new Error('> Build failed because of webpack errors')\n    } else {\n      telemetry.record(\n        eventBuildCompleted(pagePaths, {\n          durationInSeconds: webpackBuildEnd[0],\n        })\n      )\n\n      if (result.warnings.length > 0) {\n        Log.warn('Compiled with warnings\\n')\n        console.warn(result.warnings.join('\\n\\n'))\n        console.warn()\n      } else {\n        Log.info('Compiled successfully')\n      }\n    }\n\n    const postCompileSpinner = createSpinner({\n      prefixText: `${Log.prefixes.info} Collecting page data`,\n    })\n\n    const buildManifestPath = path.join(distDir, BUILD_MANIFEST)\n\n    const ssgPages = new Set<string>()\n    const ssgStaticFallbackPages = new Set<string>()\n    const ssgBlockingFallbackPages = new Set<string>()\n    const staticPages = new Set<string>()\n    const invalidPages = new Set<string>()\n    const hybridAmpPages = new Set<string>()\n    const serverPropsPages = new Set<string>()\n    const additionalSsgPaths = new Map<string, Array<string>>()\n    const pageInfos = new Map<string, PageInfo>()\n    const pagesManifest = JSON.parse(\n      await promises.readFile(manifestPath, 'utf8')\n    ) as PagesManifest\n    const buildManifest = JSON.parse(\n      await promises.readFile(buildManifestPath, 'utf8')\n    ) as BuildManifest\n\n    let customAppGetInitialProps: boolean | undefined\n    let namedExports: Array<string> | undefined\n    let isNextImageImported: boolean | undefined\n\n    process.env.NEXT_PHASE = PHASE_PRODUCTION_BUILD\n\n    const staticCheckWorkers = new Worker(staticCheckWorker, {\n      numWorkers: config.experimental.cpus,\n      enableWorkerThreads: config.experimental.workerThreads,\n    }) as Worker & { isPageStatic: typeof isPageStatic }\n\n    staticCheckWorkers.getStdout().pipe(process.stdout)\n    staticCheckWorkers.getStderr().pipe(process.stderr)\n\n    const runtimeEnvConfig = {\n      publicRuntimeConfig: config.publicRuntimeConfig,\n      serverRuntimeConfig: config.serverRuntimeConfig,\n    }\n\n    hasNonStaticErrorPage =\n      hasCustomErrorPage &&\n      (await hasCustomGetInitialProps(\n        getPagePath('/_error', distDir, isLikeServerless),\n        runtimeEnvConfig,\n        false\n      ))\n\n    let hasSsrAmpPages = false\n\n    const analysisBegin = process.hrtime()\n    await Promise.all(\n      pageKeys.map(async (page) => {\n        const actualPage = normalizePagePath(page)\n        const [selfSize, allSize] = await getJsPageSizeInKb(\n          actualPage,\n          distDir,\n          buildManifest\n        )\n\n        let isSsg = false\n        let isStatic = false\n        let isHybridAmp = false\n        let ssgPageRoutes: string[] | null = null\n\n        const nonReservedPage = !page.match(\n          /^\\/(_app|_error|_document|api(\\/|$))/\n        )\n\n        if (nonReservedPage) {\n          const serverBundle = getPagePath(page, distDir, isLikeServerless)\n\n          if (customAppGetInitialProps === undefined) {\n            customAppGetInitialProps = await hasCustomGetInitialProps(\n              isLikeServerless\n                ? serverBundle\n                : getPagePath('/_app', distDir, isLikeServerless),\n              runtimeEnvConfig,\n              true\n            )\n\n            namedExports = getNamedExports(\n              isLikeServerless\n                ? serverBundle\n                : getPagePath('/_app', distDir, isLikeServerless),\n              runtimeEnvConfig\n            )\n\n            if (customAppGetInitialProps) {\n              console.warn(\n                chalk.bold.yellow(`Warning: `) +\n                  chalk.yellow(\n                    `You have opted-out of Automatic Static Optimization due to \\`getInitialProps\\` in \\`pages/_app\\`. This does not opt-out pages with \\`getStaticProps\\``\n                  )\n              )\n              console.warn(\n                'Read more: https://err.sh/next.js/opt-out-auto-static-optimization\\n'\n              )\n            }\n          }\n\n          try {\n            let workerResult = await staticCheckWorkers.isPageStatic(\n              page,\n              serverBundle,\n              runtimeEnvConfig,\n              config.i18n?.locales,\n              config.i18n?.defaultLocale\n            )\n\n            if (\n              workerResult.isStatic === false &&\n              (workerResult.isHybridAmp || workerResult.isAmpOnly)\n            ) {\n              hasSsrAmpPages = true\n            }\n\n            if (workerResult.isHybridAmp) {\n              isHybridAmp = true\n              hybridAmpPages.add(page)\n            }\n\n            if (workerResult.isNextImageImported) {\n              isNextImageImported = true\n            }\n\n            if (workerResult.hasStaticProps) {\n              ssgPages.add(page)\n              isSsg = true\n\n              if (workerResult.prerenderRoutes) {\n                additionalSsgPaths.set(page, workerResult.prerenderRoutes)\n                ssgPageRoutes = workerResult.prerenderRoutes\n              }\n\n              if (workerResult.prerenderFallback === 'blocking') {\n                ssgBlockingFallbackPages.add(page)\n              } else if (workerResult.prerenderFallback === true) {\n                ssgStaticFallbackPages.add(page)\n              }\n            } else if (workerResult.hasServerProps) {\n              serverPropsPages.add(page)\n            } else if (\n              workerResult.isStatic &&\n              customAppGetInitialProps === false\n            ) {\n              staticPages.add(page)\n              isStatic = true\n            }\n\n            if (hasPages404 && page === '/404') {\n              if (!workerResult.isStatic && !workerResult.hasStaticProps) {\n                throw new Error(PAGES_404_GET_INITIAL_PROPS_ERROR)\n              }\n              // we need to ensure the 404 lambda is present since we use\n              // it when _app has getInitialProps\n              if (customAppGetInitialProps && !workerResult.hasStaticProps) {\n                staticPages.delete(page)\n              }\n            }\n          } catch (err) {\n            if (err.message !== 'INVALID_DEFAULT_EXPORT') throw err\n            invalidPages.add(page)\n          }\n        }\n\n        pageInfos.set(page, {\n          size: selfSize,\n          totalSize: allSize,\n          static: isStatic,\n          isSsg,\n          isHybridAmp,\n          ssgPageRoutes,\n          initialRevalidateSeconds: false,\n        })\n      })\n    )\n    staticCheckWorkers.end()\n\n    if (!hasSsrAmpPages) {\n      requiredServerFiles.ignore.push(\n        path.relative(\n          dir,\n          path.join(\n            path.dirname(require.resolve('@ampproject/toolbox-optimizer')),\n            '**/*'\n          )\n        )\n      )\n    }\n\n    if (serverPropsPages.size > 0 || ssgPages.size > 0) {\n      // We update the routes manifest after the build with the\n      // data routes since we can't determine these until after build\n      routesManifest.dataRoutes = getSortedRoutes([\n        ...serverPropsPages,\n        ...ssgPages,\n      ]).map((page) => {\n        const pagePath = normalizePagePath(page)\n        const dataRoute = path.posix.join(\n          '/_next/data',\n          buildId,\n          `${pagePath}.json`\n        )\n\n        let dataRouteRegex: string\n        let namedDataRouteRegex: string | undefined\n        let routeKeys: { [named: string]: string } | undefined\n\n        if (isDynamicRoute(page)) {\n          const routeRegex = getRouteRegex(dataRoute.replace(/\\.json$/, ''))\n\n          dataRouteRegex = normalizeRouteRegex(\n            routeRegex.re.source.replace(/\\(\\?:\\\\\\/\\)\\?\\$$/, '\\\\.json$')\n          )\n          namedDataRouteRegex = routeRegex.namedRegex!.replace(\n            /\\(\\?:\\/\\)\\?\\$$/,\n            '\\\\.json$'\n          )\n          routeKeys = routeRegex.routeKeys\n        } else {\n          dataRouteRegex = normalizeRouteRegex(\n            new RegExp(\n              `^${path.posix.join(\n                '/_next/data',\n                escapeStringRegexp(buildId),\n                `${pagePath}.json`\n              )}$`\n            ).source\n          )\n        }\n\n        return {\n          page,\n          routeKeys,\n          dataRouteRegex,\n          namedDataRouteRegex,\n        }\n      })\n\n      await promises.writeFile(\n        routesManifestPath,\n        JSON.stringify(routesManifest),\n        'utf8'\n      )\n    }\n\n    // Since custom _app.js can wrap the 404 page we have to opt-out of static optimization if it has getInitialProps\n    // Only export the static 404 when there is no /_error present\n    const useStatic404 =\n      !customAppGetInitialProps && (!hasNonStaticErrorPage || hasPages404)\n\n    if (invalidPages.size > 0) {\n      throw new Error(\n        `Build optimization failed: found page${\n          invalidPages.size === 1 ? '' : 's'\n        } without a React Component as default export in \\n${[...invalidPages]\n          .map((pg) => `pages${pg}`)\n          .join(\n            '\\n'\n          )}\\n\\nSee https://err.sh/vercel/next.js/page-without-valid-component for more info.\\n`\n      )\n    }\n\n    await writeBuildId(distDir, buildId)\n\n    await promises.writeFile(\n      path.join(distDir, SERVER_FILES_MANIFEST),\n      JSON.stringify(requiredServerFiles),\n      'utf8'\n    )\n\n    const finalPrerenderRoutes: { [route: string]: SsgRoute } = {}\n    const tbdPrerenderRoutes: string[] = []\n    let ssgNotFoundPaths: string[] = []\n\n    if (postCompileSpinner) postCompileSpinner.stopAndPersist()\n\n    if (staticPages.size > 0 || ssgPages.size > 0 || useStatic404) {\n      const combinedPages = [...staticPages, ...ssgPages]\n      const exportApp = require('../export').default\n      const exportOptions = {\n        silent: false,\n        buildExport: true,\n        threads: config.experimental.cpus,\n        pages: combinedPages,\n        outdir: path.join(distDir, 'export'),\n        statusMessage: 'Generating static pages',\n      }\n      const exportConfig: any = {\n        ...config,\n        initialPageRevalidationMap: {},\n        ssgNotFoundPaths: [] as string[],\n        // Default map will be the collection of automatic statically exported\n        // pages and incremental pages.\n        // n.b. we cannot handle this above in combinedPages because the dynamic\n        // page must be in the `pages` array, but not in the mapping.\n        exportPathMap: (defaultMap: any) => {\n          const { i18n } = config\n\n          // Dynamically routed pages should be prerendered to be used as\n          // a client-side skeleton (fallback) while data is being fetched.\n          // This ensures the end-user never sees a 500 or slow response from the\n          // server.\n          //\n          // Note: prerendering disables automatic static optimization.\n          ssgPages.forEach((page) => {\n            if (isDynamicRoute(page)) {\n              tbdPrerenderRoutes.push(page)\n\n              if (ssgStaticFallbackPages.has(page)) {\n                // Override the rendering for the dynamic page to be treated as a\n                // fallback render.\n                if (i18n) {\n                  defaultMap[`/${i18n.defaultLocale}${page}`] = {\n                    page,\n                    query: { __nextFallback: true },\n                  }\n                } else {\n                  defaultMap[page] = { page, query: { __nextFallback: true } }\n                }\n              } else {\n                // Remove dynamically routed pages from the default path map when\n                // fallback behavior is disabled.\n                delete defaultMap[page]\n              }\n            }\n          })\n          // Append the \"well-known\" routes we should prerender for, e.g. blog\n          // post slugs.\n          additionalSsgPaths.forEach((routes, page) => {\n            routes.forEach((route) => {\n              defaultMap[route] = { page }\n            })\n          })\n\n          if (useStatic404) {\n            defaultMap['/404'] = {\n              page: hasPages404 ? '/404' : '/_error',\n            }\n          }\n\n          if (i18n) {\n            for (const page of [\n              ...staticPages,\n              ...ssgPages,\n              ...(useStatic404 ? ['/404'] : []),\n            ]) {\n              const isSsg = ssgPages.has(page)\n              const isDynamic = isDynamicRoute(page)\n              const isFallback = isSsg && ssgStaticFallbackPages.has(page)\n\n              for (const locale of i18n.locales) {\n                // skip fallback generation for SSG pages without fallback mode\n                if (isSsg && isDynamic && !isFallback) continue\n                const outputPath = `/${locale}${page === '/' ? '' : page}`\n\n                defaultMap[outputPath] = {\n                  page: defaultMap[page]?.page || page,\n                  query: { __nextLocale: locale },\n                }\n\n                if (isFallback) {\n                  defaultMap[outputPath].query.__nextFallback = true\n                }\n              }\n\n              if (isSsg) {\n                // remove non-locale prefixed variant from defaultMap\n                delete defaultMap[page]\n              }\n            }\n          }\n\n          return defaultMap\n        },\n        trailingSlash: false,\n      }\n\n      await exportApp(dir, exportOptions, exportConfig)\n\n      const postBuildSpinner = createSpinner({\n        prefixText: `${Log.prefixes.info} Finalizing page optimization`,\n      })\n      ssgNotFoundPaths = exportConfig.ssgNotFoundPaths\n\n      // remove server bundles that were exported\n      for (const page of staticPages) {\n        const serverBundle = getPagePath(page, distDir, isLikeServerless)\n        await promises.unlink(serverBundle)\n      }\n      const serverOutputDir = path.join(\n        distDir,\n        isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY\n      )\n\n      const moveExportedPage = async (\n        originPage: string,\n        page: string,\n        file: string,\n        isSsg: boolean,\n        ext: 'html' | 'json',\n        additionalSsgFile = false\n      ) => {\n        file = `${file}.${ext}`\n        const orig = path.join(exportOptions.outdir, file)\n        const pagePath = getPagePath(originPage, distDir, isLikeServerless)\n\n        const relativeDest = path\n          .relative(\n            serverOutputDir,\n            path.join(\n              path.join(\n                pagePath,\n                // strip leading / and then recurse number of nested dirs\n                // to place from base folder\n                originPage\n                  .substr(1)\n                  .split('/')\n                  .map(() => '..')\n                  .join('/')\n              ),\n              file\n            )\n          )\n          .replace(/\\\\/g, '/')\n\n        const dest = path.join(\n          distDir,\n          isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n          relativeDest\n        )\n\n        if (!isSsg) {\n          pagesManifest[page] = relativeDest\n        }\n\n        const { i18n } = config\n        const isNotFound = ssgNotFoundPaths.includes(page)\n\n        // for SSG files with i18n the non-prerendered variants are\n        // output with the locale prefixed so don't attempt moving\n        // without the prefix\n        if ((!i18n || additionalSsgFile) && !isNotFound) {\n          await promises.mkdir(path.dirname(dest), { recursive: true })\n          await promises.rename(orig, dest)\n        } else if (i18n && !isSsg) {\n          // this will be updated with the locale prefixed variant\n          // since all files are output with the locale prefix\n          delete pagesManifest[page]\n        }\n\n        if (i18n) {\n          if (additionalSsgFile) return\n\n          for (const locale of i18n.locales) {\n            const curPath = `/${locale}${page === '/' ? '' : page}`\n            const localeExt = page === '/' ? path.extname(file) : ''\n            const relativeDestNoPages = relativeDest.substr('pages/'.length)\n\n            if (isSsg && ssgNotFoundPaths.includes(curPath)) {\n              continue\n            }\n\n            const updatedRelativeDest = path\n              .join(\n                'pages',\n                locale + localeExt,\n                // if it's the top-most index page we want it to be locale.EXT\n                // instead of locale/index.html\n                page === '/' ? '' : relativeDestNoPages\n              )\n              .replace(/\\\\/g, '/')\n\n            const updatedOrig = path.join(\n              exportOptions.outdir,\n              locale + localeExt,\n              page === '/' ? '' : file\n            )\n            const updatedDest = path.join(\n              distDir,\n              isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n              updatedRelativeDest\n            )\n\n            if (!isSsg) {\n              pagesManifest[curPath] = updatedRelativeDest\n            }\n            await promises.mkdir(path.dirname(updatedDest), {\n              recursive: true,\n            })\n            await promises.rename(updatedOrig, updatedDest)\n          }\n        }\n      }\n\n      // Only move /404 to /404 when there is no custom 404 as in that case we don't know about the 404 page\n      if (!hasPages404 && useStatic404) {\n        await moveExportedPage('/_error', '/404', '/404', false, 'html')\n      }\n\n      for (const page of combinedPages) {\n        const isSsg = ssgPages.has(page)\n        const isStaticSsgFallback = ssgStaticFallbackPages.has(page)\n        const isDynamic = isDynamicRoute(page)\n        const hasAmp = hybridAmpPages.has(page)\n        const file = normalizePagePath(page)\n\n        // The dynamic version of SSG pages are only prerendered if the fallback\n        // is enabled. Below, we handle the specific prerenders of these.\n        if (!(isSsg && isDynamic && !isStaticSsgFallback)) {\n          await moveExportedPage(page, page, file, isSsg, 'html')\n        }\n\n        if (hasAmp && (!isSsg || (isSsg && !isDynamic))) {\n          const ampPage = `${file}.amp`\n          await moveExportedPage(page, ampPage, ampPage, isSsg, 'html')\n\n          if (isSsg) {\n            await moveExportedPage(page, ampPage, ampPage, isSsg, 'json')\n          }\n        }\n\n        if (isSsg) {\n          const { i18n } = config\n\n          // For a non-dynamic SSG page, we must copy its data file from export.\n          if (!isDynamic) {\n            await moveExportedPage(page, page, file, true, 'json')\n\n            const revalidationMapPath = i18n\n              ? `/${i18n.defaultLocale}${page === '/' ? '' : page}`\n              : page\n\n            finalPrerenderRoutes[page] = {\n              initialRevalidateSeconds:\n                exportConfig.initialPageRevalidationMap[revalidationMapPath],\n              srcRoute: null,\n              dataRoute: path.posix.join(\n                '/_next/data',\n                buildId,\n                `${file}.json`\n              ),\n            }\n            // Set Page Revalidation Interval\n            const pageInfo = pageInfos.get(page)\n            if (pageInfo) {\n              pageInfo.initialRevalidateSeconds =\n                exportConfig.initialPageRevalidationMap[revalidationMapPath]\n              pageInfos.set(page, pageInfo)\n            }\n          } else {\n            // For a dynamic SSG page, we did not copy its data exports and only\n            // copy the fallback HTML file (if present).\n            // We must also copy specific versions of this page as defined by\n            // `getStaticPaths` (additionalSsgPaths).\n            const extraRoutes = additionalSsgPaths.get(page) || []\n            for (const route of extraRoutes) {\n              const pageFile = normalizePagePath(route)\n              await moveExportedPage(page, route, pageFile, true, 'html', true)\n              await moveExportedPage(page, route, pageFile, true, 'json', true)\n\n              if (hasAmp) {\n                const ampPage = `${pageFile}.amp`\n                await moveExportedPage(\n                  page,\n                  ampPage,\n                  ampPage,\n                  true,\n                  'html',\n                  true\n                )\n                await moveExportedPage(\n                  page,\n                  ampPage,\n                  ampPage,\n                  true,\n                  'json',\n                  true\n                )\n              }\n\n              finalPrerenderRoutes[route] = {\n                initialRevalidateSeconds:\n                  exportConfig.initialPageRevalidationMap[route],\n                srcRoute: page,\n                dataRoute: path.posix.join(\n                  '/_next/data',\n                  buildId,\n                  `${normalizePagePath(route)}.json`\n                ),\n              }\n\n              // Set route Revalidation Interval\n              const pageInfo = pageInfos.get(route)\n              if (pageInfo) {\n                pageInfo.initialRevalidateSeconds =\n                  exportConfig.initialPageRevalidationMap[route]\n                pageInfos.set(route, pageInfo)\n              }\n            }\n          }\n        }\n      }\n\n      // remove temporary export folder\n      await recursiveDelete(exportOptions.outdir)\n      await promises.rmdir(exportOptions.outdir)\n      await promises.writeFile(\n        manifestPath,\n        JSON.stringify(pagesManifest, null, 2),\n        'utf8'\n      )\n\n      if (postBuildSpinner) postBuildSpinner.stopAndPersist()\n      console.log()\n    }\n\n    const analysisEnd = process.hrtime(analysisBegin)\n    telemetry.record(\n      eventBuildOptimize(pagePaths, {\n        durationInSeconds: analysisEnd[0],\n        staticPageCount: staticPages.size,\n        staticPropsPageCount: ssgPages.size,\n        serverPropsPageCount: serverPropsPages.size,\n        ssrPageCount:\n          pagePaths.length -\n          (staticPages.size + ssgPages.size + serverPropsPages.size),\n        hasStatic404: useStatic404,\n        hasReportWebVitals: namedExports?.includes('reportWebVitals') ?? false,\n        rewritesCount: rewrites.length,\n        headersCount: headers.length,\n        redirectsCount: redirects.length - 1, // reduce one for trailing slash\n      })\n    )\n\n    if (ssgPages.size > 0) {\n      const finalDynamicRoutes: PrerenderManifest['dynamicRoutes'] = {}\n      tbdPrerenderRoutes.forEach((tbdRoute) => {\n        const normalizedRoute = normalizePagePath(tbdRoute)\n        const dataRoute = path.posix.join(\n          '/_next/data',\n          buildId,\n          `${normalizedRoute}.json`\n        )\n\n        finalDynamicRoutes[tbdRoute] = {\n          routeRegex: normalizeRouteRegex(getRouteRegex(tbdRoute).re.source),\n          dataRoute,\n          fallback: ssgBlockingFallbackPages.has(tbdRoute)\n            ? null\n            : ssgStaticFallbackPages.has(tbdRoute)\n            ? `${normalizedRoute}.html`\n            : false,\n          dataRouteRegex: normalizeRouteRegex(\n            getRouteRegex(dataRoute.replace(/\\.json$/, '')).re.source.replace(\n              /\\(\\?:\\\\\\/\\)\\?\\$$/,\n              '\\\\.json$'\n            )\n          ),\n        }\n      })\n      const prerenderManifest: PrerenderManifest = {\n        version: 2,\n        routes: finalPrerenderRoutes,\n        dynamicRoutes: finalDynamicRoutes,\n        notFoundRoutes: ssgNotFoundPaths,\n        preview: previewProps,\n      }\n\n      await promises.writeFile(\n        path.join(distDir, PRERENDER_MANIFEST),\n        JSON.stringify(prerenderManifest),\n        'utf8'\n      )\n      await generateClientSsgManifest(prerenderManifest, {\n        distDir,\n        buildId,\n      })\n    } else {\n      const prerenderManifest: PrerenderManifest = {\n        version: 2,\n        routes: {},\n        dynamicRoutes: {},\n        preview: previewProps,\n        notFoundRoutes: [],\n      }\n      await promises.writeFile(\n        path.join(distDir, PRERENDER_MANIFEST),\n        JSON.stringify(prerenderManifest),\n        'utf8'\n      )\n    }\n\n    const images = { ...config.images }\n    const { deviceSizes, imageSizes } = images\n    images.sizes = [...deviceSizes, ...imageSizes]\n\n    await promises.writeFile(\n      path.join(distDir, IMAGES_MANIFEST),\n      JSON.stringify({\n        version: 1,\n        images,\n      }),\n      'utf8'\n    )\n\n    await promises.writeFile(\n      path.join(distDir, EXPORT_MARKER),\n      JSON.stringify({\n        version: 1,\n        hasExportPathMap: typeof config.exportPathMap === 'function',\n        exportTrailingSlash: config.trailingSlash === true,\n        isNextImageImported: isNextImageImported === true,\n      }),\n      'utf8'\n    )\n    await promises.unlink(path.join(distDir, EXPORT_DETAIL)).catch((err) => {\n      if (err.code === 'ENOENT') {\n        return Promise.resolve()\n      }\n      return Promise.reject(err)\n    })\n\n    staticPages.forEach((pg) => allStaticPages.add(pg))\n    pageInfos.forEach((info: PageInfo, key: string) => {\n      allPageInfos.set(key, info)\n    })\n\n    await printTreeView(\n      Object.keys(mappedPages),\n      allPageInfos,\n      isLikeServerless,\n      {\n        distPath: distDir,\n        buildId: buildId,\n        pagesDir,\n        useStatic404,\n        pageExtensions: config.pageExtensions,\n        buildManifest,\n      }\n    )\n\n    if (debugOutput) {\n      printCustomRoutes({ redirects, rewrites, headers })\n    }\n\n    if (config.analyticsId) {\n      console.log(\n        chalk.bold.green('Next.js Analytics') +\n          ' is enabled for this production build. ' +\n          \"You'll receive a Real Experience Score computed by all of your visitors.\"\n      )\n      console.log('')\n    }\n\n    if (chromeProfiler) {\n      const parsedResults = await chromeProfiler.profiler.stopProfiling()\n      await new Promise((resolve) => {\n        if (parsedResults === undefined) {\n          chromeProfiler.profiler.destroy()\n          chromeProfiler.trace.flush()\n          chromeProfiler.end(resolve)\n          return\n        }\n\n        const cpuStartTime = parsedResults.profile.startTime\n        const cpuEndTime = parsedResults.profile.endTime\n\n        chromeProfiler.trace.completeEvent({\n          name: 'TaskQueueManager::ProcessTaskFromWorkQueue',\n          id: ++chromeProfiler.counter,\n          cat: ['toplevel'],\n          ts: cpuStartTime,\n          args: {\n            src_file: '../../ipc/ipc_moji_bootstrap.cc',\n            src_func: 'Accept',\n          },\n        })\n\n        chromeProfiler.trace.completeEvent({\n          name: 'EvaluateScript',\n          id: ++chromeProfiler.counter,\n          cat: ['devtools.timeline'],\n          ts: cpuStartTime,\n          dur: cpuEndTime - cpuStartTime,\n          args: {\n            data: {\n              url: 'webpack',\n              lineNumber: 1,\n              columnNumber: 1,\n              frame: '0xFFF',\n            },\n          },\n        })\n\n        chromeProfiler.trace.instantEvent({\n          name: 'CpuProfile',\n          id: ++chromeProfiler.counter,\n          cat: ['disabled-by-default-devtools.timeline'],\n          ts: cpuEndTime,\n          args: {\n            data: {\n              cpuProfile: parsedResults.profile,\n            },\n          },\n        })\n\n        chromeProfiler.profiler.destroy()\n        chromeProfiler.trace.flush()\n        chromeProfiler.end(resolve)\n      })\n    }\n\n    await telemetry.flush()\n  })\n}\n\nexport type ClientSsgManifest = Set<string>\n\nfunction generateClientSsgManifest(\n  prerenderManifest: PrerenderManifest,\n  { buildId, distDir }: { buildId: string; distDir: string }\n) {\n  const ssgPages: ClientSsgManifest = new Set<string>([\n    ...Object.entries(prerenderManifest.routes)\n      // Filter out dynamic routes\n      .filter(([, { srcRoute }]) => srcRoute == null)\n      .map(([route]) => route),\n    ...Object.keys(prerenderManifest.dynamicRoutes),\n  ])\n\n  const clientSsgManifestContent = `self.__SSG_MANIFEST=${devalue(\n    ssgPages\n  )};self.__SSG_MANIFEST_CB&&self.__SSG_MANIFEST_CB()`\n\n  writeFileSync(\n    path.join(distDir, CLIENT_STATIC_FILES_PATH, buildId, '_ssgManifest.js'),\n    clientSsgManifestContent\n  )\n}\n"]}